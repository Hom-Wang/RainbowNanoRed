/*=====================================================================================================*/
/*=====================================================================================================*/
#include "stm32f1_system.h"
#include "stm32f1_usb.h"
/*=====================================================================================================*/
/*=====================================================================================================*/
static int8_t CDC_Itf_Init( void );
static int8_t CDC_Itf_DeInit( void );
static int8_t CDC_Itf_Control( uint8_t cmd, uint8_t *pbuf, uint16_t length );
static int8_t CDC_Itf_Receive( uint8_t *Buf, uint32_t *Len );
/*=====================================================================================================*/
/*=====================================================================================================*/
USBD_HandleTypeDef USBD_Device;
/*=====================================================================================================*/
/*=====================================================================================================*/
USBD_CDC_LineCodingTypeDef LineCoding = {
  115200, /* baud rate */
  0x00,   /* stop bits-1 */
  0x00,   /* parity - none */
  0x08    /* nb. of bits 8 */
};

USBD_CDC_ItfTypeDef USBD_CDC_fops = {
  CDC_Itf_Init,
  CDC_Itf_DeInit,
  CDC_Itf_Control,
  CDC_Itf_Receive
};

static int8_t CDC_Itf_Init( void )
{
  return (USBD_OK);
}

static int8_t CDC_Itf_DeInit( void )
{
  return (USBD_OK);
}

static int8_t CDC_Itf_Control( uint8_t cmd, uint8_t *pbuf, uint16_t length )
{ 
  return (USBD_OK);
}

static int8_t CDC_Itf_Receive( uint8_t *Buf, uint32_t *Len )
{
  return (USBD_OK);
}
/*=====================================================================================================*/
/*=====================================================================================================*
**函數 : USB_VCP_Init
**功能 : USB VCP Init
**輸入 : None
**輸出 : None
**使用 : USB_VCP_Init();
**=====================================================================================================*/
/*=====================================================================================================*/
void USB_VCP_Init( void )
{
  /* Init Device Library */
  USBD_Init(&USBD_Device, &VCP_Desc, 0);
  /* Add Supported Class */
  USBD_RegisterClass(&USBD_Device, USBD_CDC_CLASS);
  /* Add CDC Interface Class */
  USBD_CDC_RegisterInterface(&USBD_Device, &USBD_CDC_fops);
  /* Start Device Process */
  USBD_Start(&USBD_Device);
}
/*====================================================================================================*/
/*====================================================================================================*
**函數 : USB_VCP_SendByte
**功能 : Send Byte
**輸入 : sendByte
**輸出 : None
**使用 : USB_VCP_SendByte('A');
**====================================================================================================*/
/*====================================================================================================*/
void USB_VCP_SendByte( uint8_t sendByte )
{
  USBD_LL_Transmit(&USBD_Device, CDC_IN_EP, &sendByte, 1);
}
/*====================================================================================================*/
/*====================================================================================================*
**函數 : USB_VCP_SendData
**功能 : Send Data
**輸入 : *sendData, lens
**輸出 : None
**使用 : USB_VCP_SendData(sendData, lens);
**====================================================================================================*/
/*====================================================================================================*/
void USB_VCP_SendData( uint8_t *sendData, uint16_t lens )
{
  USBD_LL_Transmit(&USBD_Device, CDC_IN_EP, sendData, lens);
}
/*====================================================================================================*/
/*====================================================================================================*
**函數 : USB_VCP_SendStr
**功能 : Send String
**輸入 : *pWord
**輸出 : None
**使用 : USB_VCP_SendStr("Hellow World!");
**====================================================================================================*/
/*====================================================================================================*/
void USB_VCP_SendStr( char *pWord )
{
  uint32_t strLens = 0;
  char *ptr = pWord;

  while(*ptr++ != '\0')
    strLens++;

  USBD_LL_Transmit(&USBD_Device, CDC_IN_EP, (uint8_t*)pWord, strLens);
}
/*====================================================================================================*/
/*====================================================================================================*
**函數 : USB_VCP_RecvByte
**功能 : Recv Byte
**輸入 : *recvByte
**輸出 : None
**使用 : recvByte = USB_VCP_RecvByte();
**====================================================================================================*/
/*====================================================================================================*/
//uint8_t USB_VCP_RecvByte( void )
//{
//  uint8_t recvByte = 0;
//  USBD_LL_PrepareReceive(&USBD_Device, CDC_OUT_EP, &recvByte, 1);
//  return recvByte;
//}
/*====================================================================================================*/
/*====================================================================================================*
**函數 : USB_VCP_RecvData
**功能 : Recv Data
**輸入 : *recvData, lens
**輸出 : None
**使用 : USB_VCP_RecvData(recvData, lens);
**====================================================================================================*/
/*====================================================================================================*/
//void USB_VCP_RecvData( uint8_t *recvData, uint16_t lens )
//{
//  USBD_LL_PrepareReceive(&USBD_Device, CDC_OUT_EP, recvData, lens);
//}
/*=====================================================================================================*/
/*=====================================================================================================*/
